\documentclass[a4paper]{report}

\usepackage{polski}
\usepackage[utf8]{inputenc}
\usepackage[polish]{babel}
\usepackage[pdftex]{graphicx}
\usepackage[pdftex]{hyperref}
\usepackage{mdwlist}
\usepackage{bm}

\begin{document}

\title{Specyfikacja wymagań dla systemu telemedycznego realizowanego w ramach projektu XXX}
\author{Zespół Projektowy}
\date{03/03/2012}
\maketitle

\tableofcontents

\chapter{Założenia ogólne}

Od strony funkcjonalnej System składa się z dwóch niezależnych podsystemów działających na tej samej platformie sprzętowej i programowej: Podsystem Elektronicznego Zlecania Opisów Badań Medycznych (zwany danej Systemem Zlecania) oraz Podsystem Elektronicznej Wymiany Danych Medycznych (zwany dalej Bazą Metadanych).

\section{Definicje}

\begin{description}
\item[System] centralny system telemedyczny, będący przedmiotem tej specyfikacji
\item[Zleceniodawca] użytkownik węzła lokalnego zlecający do systemu wykonanie opisu badania
\item[Konsultant] użytkownik węzła lokalnego realizujący zlecenie opisu badania, które pojawiło się na jego węźle
\item[Zlecenie] zlecenie opisu badania medycznego
\item[Węzeł centralny] serwer lub grupa serwerów znajdująca się w siedzibie zamawiającego; węzeł centralny posiada informacje o węzłach lokalnych i ma stałą łączność z nimi
\item[Węzeł lokalny] serwer znajdujący się w siedzibie użytkownika (w szpitalu); węzeł lokalny ma łączność z węzłem centralnym; innymi węzłami lokalnymi oraz z LSS
\item[LSS] lokalne systemy szpitalne -- wewnętrzne systemy funkcjonujące w danej jednostce medycznej, typu PACS, HIS, RIS; komunikacja Systemu z nimi odbywa się za pomocą protokołów DICOM oraz HL7
\item[interfejs webowy] interfejs użytkownika dostępny zdalnie za pomocą przeglądarki WWW.
\end{description}

\section{Architektura fizyczna}
\label{sec:arch_fiz}

System działa na szeregu węzłów połączonych w topologii częściowej siatki. Rozróżnia się 2 rodzaje węzłów: centralny i lokalny. W sieci, zwanej konfederacją, występuje jeden węzeł centralny i wiele węzłów lokalnych. 

\subsection{Węzeł centralny}
Węzeł centralny może składać się z maksymalnie 4 serwerów fizycznych lub maksymalnie 6 serwerów zwirtualizowanych działających na 4 serwerach fizycznych i na tych zasobach sprzętowych musi zapewniać taką niezawodność, że awaria jednego serwera fizycznego nie powoduje utraty funkcjonalności Systemu. Obsługa awarii pojedynczego serwera musi być tak zrealizowana, że przerwa w działaniu węzła centralnego nie będzie dłuższa niż 5 minut.

Węzeł centralny ma łączność z Internetem i jest widoczny pod publicznym adresem IP. Węzeł centralny poprzez Internet komunikuje się ze wszystkimi węzłami lokalnymi. Zarządzanie węzłem centralnym odbywa się poprzez niezależny od pozostałych węzłów interfejs webowy.

\subsection{Węzeł lokalny}
Węzeł lokalny musi być możliwy do uruchomienia na pojedynczym serwerze fizycznym lub zwirtualizowanym z zainstalowanym systemem operacyjnym Debian GNU/Linux w wersji 6.0 lub nowszej i ma łączność z LSS oraz z Internetem. Na styku z Internetem jest widoczny pod publicznym adresem IP. Każdy węzeł lokalny poprzez Internet komunikuje się z węzłem centralnym i wybranymi węzłami lokalnymi.  

\section{Bezpieczeństwo sieciowe}
Węzeł centralny oraz węzły lokalne muszą być dwojako zabezpieczone:
\begin{enumerate}
\item wszystkie interfejsy zewnętrzne (interfejsy użytkownika, zdalne API itp.) muszą posiadać zabezpieczenia
pozwalające na kontrolę dostępu do nich za pomocą odpowiednich mechanizmów uwierzytelniania i autoryzowania;
komunikacja z interfejsami zewnętrznymi odbywa się poprzez połączenia szyfrowane; mechanizmy te muszę zapewniać pełne bezpieczeństwo niezależne od zabezpieczenia drugiego,
\item dostęp do interfejsów zewnętrznych jest kontrolowany za pomocą zapory ogniowej serwera udostępniającego
dany interfejs; zapora ogniowa udostępnia interfejsy zewnętrzne tylko niezbędnym klientom.
\end{enumerate}

\section{Konfigurowalność}

\begin{enumerate}
  \item Możliwość zdefiniowania wyglądu interfejsu użytkownika za pomocą CSS (Cascading Style Sheets).

  Wszystkie pliki \emph{css} muszą znajdować się w specjalnie do tego przeznaczonym katalogu (i ewentualnie
  jego podkatalogach) oraz być dostępne dla administratora węzła do modyfikacji. Z nazw plików musi wynikać
  ich przeznaczenie. Używane nazwy klas i identyfikatory obiektów muszą być w miarę możliwości czytelne
  dla człowieka.

  \item Możliwość określenia bogato sformatowanej treści, która pojawia się jako pierwszy ekran systemu
  i zawiera formularz logowania do systemu lub w przypadku uwierzytelniania za pomocą certyfikatów X.509,
  przycisk wejścia do systemu.

\end{enumerate}

\section{Ochrona danych osobowych}

Węzeł centralny nie gromadzi i nie przetwarza danych osobowych ani danych wrażliwych. Węzły lokalne, będące pod zarządem jednostek medycznych, u których są zainstalowane mogą przetwarzać dane osobowe.

\section{Rejestracja przebiegu procesów oraz raportowanie}

Przebieg wszystkich procesów realizowanych przez węzły lokalne oraz węzeł 
centralny musi być rejestrowany w sposób umożliwiający: 
\begin{enumerate}
  \item prowadzenie rozliczeń finansowych pomiędzy zlecającymi i konsultantami,
  \item przeprowadzenie audytu poprawności przebiegu procesów,
  \item stwierdzenie kto, kiedy i jakie dane modyfikował, a w przypadku dostępu do danych
  jednostki zewnętrznej, również fakt przeglądania danych medycznych.
  \item eksport zebranych danych do uniwersalnych formatów takich jak: CSV i XML.
\end{enumerate}

\section{Cechy interfejsu użytkownika}

\begin{enumerate}
  \item Zasady weryfikacja poprawności danych wprowadzanych do formularzy, o ile
  nie wyspecyfikowano tego inaczej dla konkretnego pola, są następujące:
  \begin{enumerate}
    \item weryfikacja pola odbywa się bezpośrednio po zakończeniu wprowadzania zmian do pola, czyli utracie przez pole skupienia (fokusu)
    lub inna możliwość: weryfikacja pola odbywa się po utracie skupienia lub po upływie konfigurowalnego czasu od ostatniej zmiany zawartości pola,
    \item efekty weryfikacji poprawności danego pola są prezentowane bezpośrednio przy polu w sposób nie angażujący użytkownika do wykonania
    akcji (np. zatwierdzenia komunikatu poprzez kliknięcie),
    \item efekty weryfikacji powinny być tak prezentowane, aby użytkownik mógł szybko określić, które pola mają
    nieprawidłową treść (użycie odpowiednich kolorów w celu oznaczenia prawidłowych i nieprawidłowych pól oraz towarzyszących
    im komunikatów),
    \item jeśli formularz zawiera pola z nieprawidłowymi danymi, to użytkownik nie może wywołać akcji dla której dostarcza on dane
  \end{enumerate}

\end{enumerate}


%--------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------
\chapter[Podsystem Elektronicznego Zlecania Opisów Badań]{Wymagana funkcjonalność Podsystemu Elektronicznego Zlecania Opisów Badań Medycznych}

Zadaniem podsystemu jest umożliwienie użytkownikom węzłów lokalnych zlecanie między sobą opisów
badań medycznych oraz odbiór gotowych opisów. Zlecenia wysyłane są do węzła centralnego, który
dystrybuuje je do węzłów lokalnych konsultantów. Zlecenie stanowi pakiet danych zawierający
treść zlecenia oraz pliki będące wynikiem badania, które ma zostać opisane. 

\section{Wymagania ogólne}
\begin{enumerate}
\item Co najmniej 3 poziomy dostępu:
        \begin{enumerate}
        \item technik -- może tworzyć zlecenia, ale nie może ich wysłać,
        \item zleceniodawca -- uprawnienia technika powiększone o możliwość wysyłania zleceń,
        \item administrator -- ma możliwość zmiany konfiguracji systemu i ingerencji w dane poza produkcyjnym schematem działania.
        \end{enumerate}
\item Routingiem zleceń zajmuje się węzeł centralny.
\item Na węźle centralnym nie pojawiają się dane wrażliwe i osobowe.
\item W celu wymiany danych wrażliwych węzły lokalne komunikują się bezpośrednio między sobą.
\item Komunikaty sygnalizacyjne przechodzą przez węzeł centralny.
\item Węzeł centralny posiada pełną wiedzę zarówno o aktualnie przetwarzanych zleceniach jak i o zleceniach przetworzonych w przeszłości.
\end{enumerate}

\section{Definicja zlecenia}

Zlecenie jest dokumentem elektronicznym zawierającym opis zlecenia wraz z niezbędnymi atrybutami oraz listę załączonych dokumentów (również elektronicznych). Załączone dokumenty muszą być identyfikowane w sposób jednoznaczny. Musi istnieć również mechanizm pozwalający na zlokalizowanie dokumentu na podstawie jego identyfikatora lub identyfikatora w połączeniu ze zleceniem. Zamawiający zaleca stosowanie URI do identyfikacji załączonych dokumentów jak i samego zlecenia.

Zlecenie powinno posiadać co najmniej następujące atrybuty:
\begin{enumerate*}
\item globalnie unikatowy numer zlecenia
\item dane identyfikujące zleceniodawcę
\item dane kontaktowe zleceniodawcy
\item data wykonania badania
\item lista załączników 
\item zanonimizowane dane o pacjencie, takie jak wiek, płeć
\item treść definiującą co ma być opisane
\item określenie listy odbiorców zlecenia
\item określenie nazwy usługi do której zlecenie jest kierowane
\item określenie typu badania
\item określenie modalności
\item określenie czasu na wykonanie opisu badania (z dokładnością do co najmniej 1 minuty)
\end{enumerate*}

\section{Przetwarzanie zleceń}

Funkcje silnika przetwarzania zleceń:
\begin{enumerate}
  \item dbanie aby zlecenia były niezawodnie dostarczane do właściwych konsultantów,
  \item dbanie aby dane zlecenie mogło być w jednym momencie opisywane tylko przez jednego konsultanta,
  \item taki dobór strategii wysyłania badań, aby zlecenie mogło być opisane w możliwie najkrótszym czasie (np. poprzez natychmiastowe rozpoczęcie wysyłania danych obrazowych do wybranego konsultanta, wysłanie danych obrazowych do innego konsultanta, jeśli wcześniejszy długo nie podejmuje opisu badania),
  \item item dbanie aby zlecenia o krótkim czasie na wykonanie opisu, miały wyższy priorytet przy wysyłaniu danych obrazowych do konsultanta,
  \item po stronie zleceniodawcy:
  \begin{enumerate}
    \item przygotowanie kompletu danych zlecenia,
    \item wybór listy konsultantów na podstawie konfiguracji węzła i danych wprowadzonych przez użytkownika zlecającego,
    \item wysyłanie wg. zadanej strategii zleceń do poszczególnych konsultantów ,
    \item pozyskanie opisu badania od konsultanta,
    \item monitorowanie przebiegu procesu wysyłania zlecenia i prezentacja wyników dla zleceniodawcy poprzez interfejs użytkownika, 
    \item monitorowanie stanu wysłanego zlecenia i jego prezentacja dla zleceniodawcy poprzez interfejs użytkownika,
  \end{enumerate}
  \item po stronie konsultanta:
  \begin{enumerate}
    \item przyjmowanie zleceń opisów badań obrazowych,
    \item monitorowanie przebiegu procesu odbierania zlecenia i prezentacja wyników dla konsultanta poprzez interfejs użytkownika
    \item prezentacja kolejki zleceń czekających na opis, 
    \item przekazanie danych obrazowych związanych ze zleceniem do LSS,
    \item informowanie zainteresowanych węzłów o podjęciu realizacji zlecenia,
  \end{enumerate}
\end{enumerate}

Silnik musi przewidywać obsługę następujących scenariuszy:
\begin{enumerate}
  \item Badanie jest prezentowane konsultantowi lub konsultantom już w momencie rozpoczęcia transferu. Prezentacja badania na liście obejmuje:
  \begin{enumerate}
    \item Bieżący stan transferu w postaci ilości serii/łączna liczba serii i ilości obrazków w każdej serii.
    \item Meta dane zlecenia (Imię, Nazwisko, Pesel/Data urodzenia, modalność, kod badania, data i godzina badania, czas do którego należy dokonać opisu, uwagi do badania).
  \end{enumerate}

  \item W zależności od konfiguracji, badania mogą być prezentowane jednocześnie na listach wszystkich wybranych konsultantów, lub po kolei, tak jak odbywa się transfer danych obrazowych. W pierwszej sytuacji otwarcie badania oznacza jednocześnie rozpoczęcie jego transferu o ile nie był on otwarty przez inny węzeł.
3. Badanie może być otwarte w dowolnym momencie transferu.
4. W momencie otwarcie badania, nie może być ono otwarte na innym węźle.
5. Jeżeli czas na opisanie badania zostanie przekroczone, badanie jest oznaczane jako przeterminowane.
6. Jeden opisujący może otworzyć w danym czasie tylko jedno badanie.
7. Opisujący badanie może przedłużyć czas opisu poprzez reakcję z systemem. Czas oczekiwania systemu na reakcję jest konfigurowalny.
8. Obsługa badania przeterminowanego polega na jego cofnięciu do puli badań do opisu.
9. Centrum gromadzi informację o stanie węzłów lokalnych.
10. Routing badań jest wykonywany w oparciu o następujące parametry:
a. Stany dostępności węzła.
b. Przepływność łącza.
c. Czasy obsługi zleceń.
d. Preferencji zlecającego.
11. Statystyki z list i opisów powinny być zachowywane i archiwizowane.
\end{enumerate}


\section{Integracja węzłów lokalnych z lokalnymi systemami szpitalnymi}

Węzeł lokalny musi mieć możliwość komunikacji z lokalnym systemem PACS w celu:
\begin{enumerate}
 \item po stronie zleceniodawcy: pozyskania wyników badania, które ma być opisane,
 \item po stronie konsultanta: przesłania wyników badania na stację diagnostyczną.
\end{enumerate}

Węzeł lokalny musi mieć interfejs HL7 służący do komunikacji z systemami RIS. Interfejs musi mieć funkcjonalność potrzebną do zlecania opisu badań z poziomu systemu RIS oraz przekazywania gotowych opisów do systemu RIS. Interfejs musi być dokładnie opisany, tak aby podmioty trzecie mogły dostosować swoje systemy do korzystania z tego interfejsu. Dodatkowo interfejs w miarę możliwości powinien być tak zaprojektowany, aby nie sprawiał zbędnych trudności przy integracji z takimi systemami jak: TODO lista systemów, 

Pozyskiwanie danych z systemu PACS musi odbywać się na 2 sposoby:
\begin{enumerate}
  \item aktywne odpytanie systemu PACS i pobranie plików do bufora na węźle lokalnym
  \item pasywne oczekiwanie na dostarczenie plików przez PACS lub inny węzeł DICOM; dostarczone pliki zapisywane są w buforze na węźle lokalnym
\end{enumerate}

\section{Interfejs użytkownika}

Wymagany jest webowy interfejs użytkownika do realizacji wszystkich podstawowych funkcji systemu. Możliwe jest zastosowanie również dodatkowych niewebowych interfejsów użytkownika. Każdy z węzłów lokalnych oraz węzeł centralny muszą mieć swoje własne interfejsy użytkownika.

Wymagania dla webowego interfejsu użytkownika:

\begin{enumerate}
    \item neutralność technologiczna zapewniona poprzez:
	  \begin{enumerate}
	  \item poprawne działanie na najnowszej na dzień ogłoszenia przetargu wersji wieloplatformowych przeglądarek WWW Mozilla Firefox oraz Google Chrome
	  \item realizację wszystkich podstawowych funkcji interfejsu użytkownika bez wymagania jakichkolwiek dodatków do przeglądarek, czy używania funkcji przeglądarek specyficznych dla określonego systemu operacyjnego na którym przeglądarka działa.
	  \end{enumerate}
    \item sprawność działania zapewniona poprzez:
	  \begin{enumerate}
	  \item takie zaprojektowanie interfejsu, aby zminimalizować ilość interakcji z użytkownikiem -- minimalizacja ilości kliknięć wymaganych do wykonania określonej czynności oraz ilość wprowadzanych ręcznie przez użytkownika danych
	  \item takie zaprojektowanie interfejsu aby zminimalizować czas reakcji interfejsu na akcję użytkownika - interfejs użytkownika musi sprawnie działać [określić, co to znaczy sprawnie działać] w przeglądarce uruchomionej na komputerze z procesorem o wydajności KKK i 360 MB pamięci RAM dostępnej dla przeglądarki
	  \end{enumerate}
\end{enumerate}

Podstawowe funkcje interfejsu użytkownika:
\begin{enumerate}
  \item Tworzenie zlecenia:
      \begin{enumerate}
      \item przy tworzeniu zlecenia użytkownik musi mieć możliwość dostarczenia kompletnej definicji zlecenia (patrz opis treści zlecenia)
      \item użytkownik musi mieć możliwość załączenia do zlecenia plików z wynikami badań oraz innych plików (np. skan  skierowania na badanie); wymagana jest obsługa 3 sposobów dostarczania plików: wybór pliku z zasobów dyskowych dostępnych w systemie operacyjnym, na którym działa przeglądarka, wybór pliku znajdującego się w buforze plików DICOM na węźle lokalnym, uruchomienie wyszukiwarki plików w systemie PACS, a następnie pobranie wybranych przez użytkownika plików do bufora i automatyczne załączenie ich do zlecenia
      \end{enumerate}
  \item Wysyłanie zlecenia:
\end{enumerate}

\section{Schemat pracy}
\begin{enumerate}
\item Użytkownik łączy się przeglądarką WWW z lokalnym interfejsem Systemu, loguje się do niego i ma możliwość:
        \begin{enumerate}
        \item przejrzenia stanu aktualnych (będących w trakcie przetwarzania) zleceń,
        \item przeglądania zleceń archiwalnych,
        \item modyfikacji aktualnych, niezakończonych zleceń,
        \item stworzenia nowego zlecenia,
        \item wysłania gotowego zlecenia,
        \item realizacji zlecenia (opisania badania).
        \end{enumerate}
\item W ramach tworzenia/modyfikacji zlecenia użytkownik może:
        \begin{enumerate}
        \item wybrać pliki DICOM (pogrupowane np. wg. StudyUID, albo nazwy pacjenta) znajdujące się w buforze na węźle (pliki do bufora trafiają w wyniku wysłania ich do węzła z poziomu systemu PACS)
        \item wyszukać i pobrać pliki DICOM bezpośrednio z PACS
        \item wysłać poprzez interfejs web plik istniejący na terminalu użytkownika
        \item zmodyfikować wszystkie istotne na tym etapie parametry zlecenia
        \end{enumerate}
\end{enumerate}

\section{Konfigurowalność}

TODO Co musi być konfigurowalne w systemie zlecania 
TODO konfigurowalność interfejsu HL7

%--------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------
\chapter[Podsystem Elektronicznej Wymiany Danych Medycznych]{Wymagana funkcjonalność Podsystemu Elektronicznej Wymiany Danych Medycznych}

\section{Definicje}
\begin{description}
\item[użytkownik] Uprawniony pracownik jednostki medycznej posiadającej węzeł lokalny, który chce pozyskać dane
      medyczne dostępne w innych jednostkach medycznych.
\item[dane medyczne] Wyniki badań medycznych pacjentów oraz ich opisy przechowywane w LSS.
\item[identyfikator pacjenta] Identyfikator pacjenta używany w LSS. Identyfikator pacjenta zawsze występuje w kontekście
      konkretnego LSS, a bez niego nie ma znaczenia.
\item[baza powiązań identyfikatorów] Baza danych wiążąca identyfikatory pacjentów z różnych LSS. Istnienie powiązania
      identyfikatorów jest jednocześnie wskazaniem, na istnienie badań medycznych w różnych węzłach lokalnych dotyczących
      tego samego pacjenta.
\end{description}

\section{Wymagania ogólne}



\section{Schematy działania}

Działanie systemu POWINNO|MUSI przebiegać wg. niżej opisanych schematów.

\subsection{Interfejs użytkownika - wyszukiwanie}
\begin{enumerate}
  \item Użytkownik uwierzytelnia się w systemie i uzyskuje dostęp do interfejsu użytkownika.

    Uwierzytelnienie (logowanie) może odbywać się za pomocą loginu i hasła lub certyfikatu X.509 (PYTANIE, czy
    zaimplementowane mają być obie metody). Bez uwierzytelnienia się użytkownika nie ma dostępu do
    żadnych funkcji ani informacji dostępnych w systemie, poza informacją o sposobie skontaktowania
    się z lokalnym administratorem.

  \item TODO jakie opcje ma użytkownik na głównej stronie do wyboru
  \item Użytkownik wprowadza do węzła lokalnego dane osobowe pacjenta, którego dane medyczne są poszukiwane.

        Wymagane jest aby użytkownik wprowadził 3 dane: imię, nazwisko oraz datę urodzenia lub PESEL.
        Data musi być wprowadzana w formacie ISO 8601 i poddawana weryfikacji. PESEL również musi być
        poddawany weryfikacji włącznie ze sprawdzeniem cyfry kontrolnej.
  
  \item Użytkownik jednym przyciskiem zatwierdza wprowadzone dane, rozpoczyna procedurę wyszukiwania danych i przenosi
  się na ekran prezentacji wyników.

        Zbieranie odpowiedzi na zapytanie odbywa się w tle. Uzyskane odpowiedzi są na bieżąco prezentowane na
        ekranie wyników bez oczekiwania na zakończenie całej procedury wyszukiwania. W trakcie zbierania odpowiedzi
        interfejs użytkownika nie jest zablokowany i użytkownik może przeglądać wyniki, które na bieżąco się pojawiają.
        Użytkownik może za pomocą przycisku przerwać procedurę wyszukiwania. Przerwanie procedury wyszukiwania
        nie wpływa na otrzymane już wyniki, a jedynie zatrzymuje dalsze odpytywanie.
  
\end{enumerate}

\subsection{Węzły - wyszukiwanie}

Aby spełnić wymagania funkcjonalne węzły mogą się komunikować np. w poniżej opisany sposób.
Definicje symboli użytych w opisie:
\begin{description}
  \item[\bm{$C$}] Węzeł centralny
  \item[\bm{$L_S$}] Węzeł szukający danych
  \item[\bm{$L_N$}] Dowolny, zdalny względem $L_S$, węzeł lokalny o numerze $N$
  \item[\bm{$P_{SA}ID$}] Identyfikator pacjenta $A$ jakim posługuje się węzeł szukający $L_S$
  \item[\bm{$P_{NA}ID$}] Identyfikator pacjenta $A$ jakim posługuje się węzeł odpowiadający $L_N$.
\end{description}

Identyfikator pacjenta składa się z trzech elementów: identyfikatora węzła lokalnego, identyfikatora LSS i identyfikatora
pacjenta w podanym LSS. Identyfikator pacjenta może być zapisany w postaci URI, a zapytanie HTTP GET na
ten URI z dodanymi na końcu ustalonymi etykietami powinno dać w wyniku dane osobowe pacjenta lub listę badań.
  
Przebieg procesu komunikacji:
\begin{enumerate}
  \item Użytkownik wprowadza dane osobowe pacjenta poprzez interfejs użytkownika na $L_S$
  \item $L_S$, przeszukując podłączone do siebie LSS, tworzy $P_{SA}ID$,

  TODO: co jeśli pacjenta nie ma w PACS'ie? co jeśli $L_S$ jest połączony z więcej niż jednym LSS
  
  \item $L_S$ wysyła zapytanie o $P_{SA}ID$ do $C$
  \item $C$ przeszukuje swoją bazę informacji powiązań identyfikatorów i w odpowiedzi wysyła
    \begin{enumerate}
      \item listę $P_{NA}ID$ jeśli jakieś powiązania zostały odnalezione, oraz
      \item listę $L_N$, które $L_S$ powinno odpytać, ponieważ nie wiadomo, czy nie pojawiły się tam dane pacjenta
    \end{enumerate}
  \item Jeśli $C$ odpowiedziało listą $L_N$ do odpytania, to $L_S$ odpytuje je równolegle o listę $P_{NA}ID$,
  podając w zapytaniu dane osobowe pacjenta oraz $P_{SA}ID$.
  \item Za każdym razem kiedy $L_S$ otrzymuje nowe $P_{NA}ID$ odpytuje powiązane z nim $L_N$ o dostępne dane medyczne i bezpośrednio
  po otrzymaniu odpowiedzi prezentuje je użytkownikowi.
  \item Za każdym razem kiedy odpytane $L_N$ znajdzie u siebie pacjenta o odpowiednich danych osobowych, to wysyła do $C$ powiadomienie
  o dopasowaniu $P_{SA}ID$ z $P_{NA}ID$.
  \item $C$ na podstawie powiadomień o powiązaniu $P_{SA}ID$ z $P_{NA}ID$ otrzymywanych od $L_N$ buduje bazę powiązań identyfikatorów.

TODO: inwalidacja bazy powiązań identyfikatorów

TODO: 3 typy alertów przy niezgodności danych pacjenta

\end{enumerate}



\section{Opis interfejsu użytkownika}


\subsection{Interfejs administracyjny węzła lokalnego}

Interfejs administracyjny musi umożliwiać przeprowadzenie następujących czynności:
\begin{enumerate}
  \item Zarządzanie użytkownikami
        Administrator musi mieć możliwość:
        \begin{enumerate}
          \item dodawania, modyfikowania, usuwania i blokowania użytkowników; zablokowany użytkownik nie traci
          żadnych swoich ustawień, ale nie może zalogować się do systemu
          
        \end{enumerate}

  
\end{enumerate}


\section{Opis węzła centralnego}
Zadania węzła centralnego:
\begin{enumerate}
\item utrzymanie bazy informacji o danych medycznych,
\item utrzymanie bazy powiązań identyfikatorów,
\item routing zapytań,
\item przyjmowanie od węzłów lokalnych informacji o dostępnych danych medycznych,
\item przyjmowanie od węzłów lokalnych informacji o powiązaniach identyfikatorów pacjentów,
\end{enumerate}

\section{Opis węzła lokalnego}
Zadania węzła lokalnego:
\begin{enumerate}
\item Udostępnianie interfejsu użytkownika niezbędnego do prowadzania danych osobowych pacjentów
      oraz przeglądania pozyskanych danych medycznych.
\item Informowanie węzła centralnego o dostępnych w LSS danych medycznych (budowa bazy informacji o danych medycznych)
\item Informowanie węzła centralnego o odkrytych powiązaniach między identyfikatorami pacjentów
\item Udostępnianie danych medycznych uprawnionym zdalnym węzłom lokalnym

\section{Konfigurowalność}

\begin{itemize}
  \item mapowanie zapytania o pacjenta na DICOM
  \item mapowanie odpowiedzi z LSS na ustalony XML obowiązujący w Systemie
  \item możliwość określenia zestawu zapytań wysyłanych do LSS (o jakie atrybuty i w jakiej kolejności
  pytamy przy szukaniu pacjenta w LSS)
\end{itemize}

% tutaj skończyłem - Seweryn

\item komunikacja z istniejącymi lokalnymi systemami szpitalnymi:
  \begin{enumerate}
  \item należy założyć wykorzystanie w szpitalach oprogramowania pochodzącego od różnych dostawców i mogą
        się pojawić różnice nawet zapisie danych osobowych w plikach DICOM. W tym celu trzeba przewidzieć
        w tworzonym oprogramowaniu interfejs do tworzenia standaryzacji danych osobowych postaci jednolitej
        dla systemu. Same dane nie będą jednak przechowywane w węźle lokalnym – posłużą do stworzenia odwzorowania
        na jednoznaczny identyfikator pacjenta na poziomie systemu
  \item ma za zadanie przyjmować od oprogramowania szpitalnego informacje o zajściu zdarzenia dot.
        pacjenta (np. poprzez HL7)
  \item ma za zadanie pośredniczyć w udostępnianiu danych medycznych do innych węzłów lokalnych realizując
        ich zapytanie. W tym celu po zidentyfikowaniu pacjenta wysyła do takiego systemu linki do lokalnych
        plików (np. DICOM) z jego danymi medycznymi
  \end{enumerate}

\item komunikacja z węzłem centralnym
  \begin{enumerate}
  \item przekazywane są powiązania informacje o jednoznacznych identyfikatorach pacjentów
  \item opcjonalnie następuje synchronizacja z węzłem centralnym, o której mowa w pkt. 4.2.4.
  \end{enumerate}

\item komunikacja z innymi węzłami lokalnymi
  \begin{enumerate}
  \item udostępnianie danych medycznych pacjentów innym węzłom lokalnym jak opisane w pkt.  4.3.1.3.
  \item pobieranie danych z innych węzłów lokalnych
  \end{enumerate}
\end{enumerate}

Ponadto komunikacja pomiędzy węzłami lokalnymi między sobą, jak i pomiędzy nimi, a węzłem głównym musi być zabezpieczona przez zestawienie bezpiecznego tunelu VPN na poziomie sieci komputerowej (site-to-site, 'przezroczysty' VPN) lub jeśli to nie jest możliwe na poziomie węzła (client-to-site VPN)

Transmisja danych musi zapewniać integralność, poufność i autentyczność przesyłanych danych. Można to zapewnić przez bezpośredni tunel VPN pomiędzy węzłami lokalnymi.

\end{document}
